select
--distinct on (DEVICE_ID) device_id,
SOURCE,
--SEQUENCE,
DEVICE_ID,
RECEPTION_DATETIME,
--(to_timestamp(split_part(message,',', 3),'DDMMYYHH24MISS') - '3 hour'::interval ) HORA,
--STATUS,
--case
-- when message like '>RUV%' then (to_timestamp(split_part(message,',',3),'DDMMYYHH24MISS') - '3 hour'::interval)
--end as hora_ruv,
CASE split_part(message,',',1)
WHEN '>RUV0000' THEN 'TRACKING IGN ON'
WHEN '>RUV0001' THEN 'TRACKING IGN OFF'
WHEN '>RUV0003' THEN 'CURVA'
WHEN '>RUV0072' THEN 'LIGOU LIMPADOR'
WHEN '>RUV0073' THEN 'DESLIGOU LIMPADOR'
WHEN '>RUV0006' THEN 'POWER OFF'
WHEN '>RUV0007' THEN 'POWER ON'
WHEN '>RUV0320' THEN 'IDENTIFICOU CONDUTOR'
WHEN '>RUV0321' THEN 'LIGOU IGNICAO'
WHEN '>RUV0425' THEN 'DESLIGOU IGNICAO'
WHEN '>RUV0528' THEN 'DESLIGOU IGNICAO 2'
WHEN '>RUV0358' THEN 'HB GPRS'
WHEN '>RUV0309' THEN 'HB SAT'
WHEN '>RUV02191' THEN 'MENSAGEM TECLADO'
WHEN '>RUV09208' THEN 'ACELERACAO BRUSCA'
WHEN '>RUV09207' THEN 'FREADA BRUSCA'
WHEN '>RUV0038' THEN 'INICIO INF CINTO'
WHEN '>RUV0939' THEN 'FIM INF CINTO'
WHEN '>RUV0730' THEN 'INICIO INF VEL'
WHEN '>RUV0831' THEN 'FIM INF VEL'
WHEN '>RUV0209' THEN 'HB SAT'
WHEN '>RUV0258' THEN 'HB GPRS'
WHEN '>RUV0265' THEN 'APONTAMENTO'
WHEN '>RUV0981' THEN 'ENTROU CERCA'
WHEN '>RUV0982' THEN 'SAIU CERCA'
WHEN '>RUV0983' THEN 'TROCA CERCA'
WHEN '>RUV00107' THEN 'HABILITA LOGICA'
WHEN '>RUV0736' THEN 'INI PAR MOTOR LIG'
WHEN '>RUV0837' THEN 'FIM PAR MOTOR LIG'
WHEN '>RUV0732' THEN 'INI INF RPM'
WHEN '>RUV0833' THEN 'FIM INF RPM'
WHEN '>RUV0081' THEN 'ENTROU ROTA 1'
WHEN '>RUV07115' THEN 'FADIGA INICIO'
WHEN '>RUV08116' THEN 'FADIGA FIM'
WHEN '>RUV0083' THEN 'ENTROU ROTA 2'
WHEN '>RUV0085' THEN 'ENTROU ROTA 3'
WHEN '>RUV0087' THEN 'ENTROU ROTA 4'
WHEN '>RUV0082' THEN 'SAIU ROTA 1'
WHEN '>RUV0084' THEN 'SAIU ROTA 2'
WHEN '>RUV0086' THEN 'SAIU ROTA 3'
WHEN '>RUV0088' THEN 'SAIU ROTA 4'
WHEN '>RUV0005' THEN 'FALHA COMUNICA?O COM TABLET'
WHEN '>RUV15222' THEN 'debug LEITURA 1 MIFARE'
WHEN '>RUV15221' THEN 'debug LEITURA 2 MIFARE'
when '>RUV0036' then 'INICIO PARADA MOTOR LIGADO'
when '>RUV0237' then 'FIM PARADA MOTOR LIGADO'
when '>RUV0233' then 'FIM INFRAÇÃO EXCESSO RPM'
when '>RUV0032' then 'INICIO INFRAÇÃO EXCESSO RPM'
when '>RUV0233' then 'FIM INFRAÇÃO EXCESSO RPM'
when '>RUV0030' then 'INICIO EXCESSO VELOCIDADE'
when '>RUV0231' then 'FIM EXCESSO VELOCIDADE'
when '>RUV02208' then 'ACELERAÇÃO BRUSCA'
when '>RUV02207' then 'FREADA BRUSCA'
when '>RUV0021' then 'INICIO OPERAÇÃO'
when '>RUV0015' then 'ENTRANDO SLEEP'
when '>RUV0281' then 'ENTRANDO CERCA REMOTA'
when '>RUV0282' then 'SAINDO CERCA REMOTA'
when 'RAX79' then 'ENTRANDO CERCA LOGISTICA'
when 'RAX80' then 'SAINDO CERCA LOGISTICA'
when 'RAX22' then 'LITROMETRO INICIO'
when 'RAX23' then 'LITROMETRO FIM'
-- ELSE split_part(message,',',1)
--(to_timestamp(split_part(message,',', 3),'DDMMYYHH24MISS') - '3 hour'::interval ) HORA,
END AS EVENTO,
--case when MESSAGE ~ 'RUV098[123]' = TRUE then split_part(message,',',9) end CERCA_ENTRADA,
--case when MESSAGE ~ 'RUV098[123]' = true then split_part(split_part(message,',',10),';',1) end CERCA_SAIDA,
message
FROM INBOX AS I
WHERE DEVICE_ID IN ('G0EB') --4031, 42DA|||| 5A9F 271E
--where device_id in ('AABD','AB0C','AC3E','AE8A','A714','D01B','D2BB','D2BF','D2B2','D2C0','D2C1','D2DA','D2D2','D2ED','D2EE','D2E1','D2E3','D2E4','D2E5','D2F1','D2F9','D23F','D248','D318','D345','D35A','D35B','D353','D464','D54D','2B91','2CF0','2D1C','2FCC','20FB','21CC','22A3','224E','23CB','23FA','2401','25C3','252E','257B','26CF','2708','2709','276D','2799','2899','2962','5A4D','5A5A','5BEF','5BFC','5BF2','5B0E','5C5D','5DCB','5D8D','5EB4','5EC0','5ED8','5E17','5E7E','5E80','5FF8','50C1','5026','504B','5045','5172','5254','527B','5311','5332','54BD','541A','577A','58C7','9014','914D','9154','9188','93E6','9626')
--and message like '%RAX183%' -- Base // Perfi de cliente // Script Veículo // adicional ex:mifare
--and message like '%VR29%'
--and (message ~ 'RAX183' or message ~ 'RAX22' or message ~ 'RAX23' or message ~ 'RUV0021' OR message ~ 'RUV0425' or message ~ 'RUV0001' OR MESSAGE ~ 'RUV0015' or message ~ 'RED22')
--order by consumption_datetime asc;
--AND (RECEPTION_DATETIME BETWEEN '2022/03/21 00:00:00' AND '2022/03/22 23:55:55')
--and reception_datetime > current_date - 2
--And (message like '>RUV0981%' or MESSAGE like '>RUV0982%' or MESSAGE like '>RUV0983%' )
--having count (device_id);
ORDER by ID desc;